<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="noticeMapper">

   <!-- 검색 -->
   <select id="getArticleCount" parameterType="hashmap" resultType="int">
	   	select nvl(count(*),0)  from notice 
	    <if test="category!=null and category !='' ">
	    where ${category}  like '%${sentence}%'
   		</if>
   </select>
   <!-- 검색한거 보여주기 -->
    <select id="getArticles" parameterType="hashmap" resultType="Notice">
      <if test="category==null or category == ''">   
		   SELECT notice_no AS noticeNo, notice_title AS noticeTitle, notice_content AS noticeContent, notice_image AS noticeFilename, notice_count AS noticeCount, notice_date AS noticeDate 
		   		FROM  ( select rownum rnum ,a.* 
		    	FROM (select * from notice
		    	ORDER BY ROWNUM DESC)
		   			a ) 
		   		WHERE rnum between #{start} and #{end}
   		</if>
    	<if test="category!=null and category !='' "> 
    	SELECT notice_no AS noticeNo, notice_title AS noticeTitle, notice_content AS noticeContent, notice_image AS noticeFilename, notice_count AS noticeCount, notice_date AS noticeDate 
		   		FROM  ( select rownum rnum ,a.* 
		    	FROM (select * from notice
		    	WHERE ${category}  like '%${sentence}%'
		    	ORDER BY ROWNUM DESC)
		   			a ) 
		   		WHERE rnum between #{start} and #{end}
   		</if>
    </select>
   
   <!-- 조회수 -->
   <update id="addReadCount" parameterType="hashmap"  >
     update notice set notice_count=notice_count+1 
         where notice_No = #{noticeNo} 
   </update>
   
   <!-- content 보기 -->
   <select id="getArticle" parameterType="hashmap"  resultType="Notice">
	   select notice_no AS noticeNo, notice_title AS noticeTitle, 
	   		notice_content AS noticeContent, notice_image AS noticeFilename, 
	   		notice_count AS noticeCount, notice_Date AS noticeDate 
	   FROM notice where notice_no = #{noticeNo} 
   </select>
   
   
   
   
   
   
   
   
   
   
   
   
   
   <!-- ADMIN -->
   <select id="getFullInfo" resultType="Notice">
		SELECT notice_no AS noticeNo, notice_title AS noticeTitle, notice_content AS noticeContent, notice_date AS noticeDate, notice_count AS noticeCount 
		FROM (
			SELECT ROWNUM RN, A.* 
				FROM (
						SELECT * 
						FROM notice 
						ORDER BY notice_no DESC) A
				)
		WHERE RN BETWEEN #{start} AND #{end}
	</select>
	
	<insert id="write" parameterType="Notice">
		<if test="noticeFilename != null">
			INSERT INTO notice VALUES (noticeSeq.nextval, #{noticeTitle}, #{noticeContent}, #{noticeFilename}, sysdate, 0)
		</if>
		<if test="noticeFilename == null">
			INSERT INTO notice(notice_no, notice_title, notice_content, notice_date, notice_count) 
			VALUES (noticeSeq.nextval, #{noticeTitle}, #{noticeContent}, sysdate, 0)
		</if>
	</insert>
	<update id="modify" parameterType="Notice">
		UPDATE notice SET notice_title = #{noticeTitle}, notice_content = #{noticeContent}
		<if test="noticeFilename != null">
			, notice_image = #{noticeFilename}
		</if>
			WHERE notice_no = #{noticeNo}
	</update>
	<delete id="del" parameterType="int">
		DELETE FROM notice WHERE notice_no = #{noticeNo}
	</delete>
</mapper>